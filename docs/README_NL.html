<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme_nl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="README_NL_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_NL_files/libs/quarto-html/quarto.js"></script>
<script src="README_NL_files/libs/quarto-html/popper.min.js"></script>
<script src="README_NL_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_NL_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_NL_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_NL_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_NL_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_NL_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_NL_files/libs/bootstrap/bootstrap-973236bd072d72a04ee9cd82dcc9cb29.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="fairness-analyse" class="level1">
<h1>Fairness Analyse</h1>
<p>Door Theo Bakker, lector Learning Technology &amp; Analytics, t.c.bakker@hhs.nl</p>
<p><em>Naar de <a href="NEWS.md">versiegeschiedenis van het template</a>.</em></p>
<p>Dit template wordt gebruikt om een fairness analyse te maken voor de Learning Technology &amp; Analytics Research Group (LTA) van De Haagse Hogeschool. Het template is gebaseerd op de huisstijl van De Haagse Hogeschool en maakt gebruik van Quarto.</p>
<section id="software" class="level2">
<h2 class="anchored" data-anchor-id="software">Software</h2>
<p>Om dit template te gebruiken heb je de volgende software, packages en fonts nodig:</p>
<ul>
<li><a href="https://quarto.org/docs/get-started/">Quarto</a> versie 1.6.39 of hoger</li>
<li><a href="https://www.xquartz.org/">XQuartz</a> (alleen voor Mac)</li>
<li>De libraries uit <code>_Setup.R</code> (worden automatisch geïnstalleerd)</li>
</ul>
</section>
<section id="opbouw-bestanden-en-folders" class="level2">
<h2 class="anchored" data-anchor-id="opbouw-bestanden-en-folders">Opbouw bestanden en folders</h2>
<p>Het template is opgebouwd uit de volgende <strong>bestanden</strong>:</p>
<ul>
<li>De index van het rapport: <code>Index.qmd</code> (voortaan Index genoemd)</li>
<li><code>_quarto.yml</code> met de algemene instelligen</li>
<li><code>_quarto-advanced.yml</code> met instellingen voor het advanced rapport</li>
<li><code>_quarto-basic.yml</code> met instellingen voor het basic rapport</li>
<li><code>_Setup.R</code> met algemene instellingen voor R</li>
<li><code>ch1-introduction.qmd</code> met de introductie (hoofdstuk 1)</li>
<li><code>ch2-equity.qmd</code> met de fairness analyse (hoofdstuk 2)</li>
<li><code>ch3-factores.qmd</code> met de analyse van factoren (hoofdstuk 3)</li>
<li><code>ch4-models.qmd</code> met de bouw van de voorspelmodellen (hoofdstuk 4)</li>
<li><code>ch5-references.qmd</code> met de referenties (hoofdstuk 5)</li>
<li><code>render-multiple.R</code> met een script om meerdere rapporten te maken</li>
<li><code>render-single.R</code> met een script om 1 rapport te maken</li>
<li><code>renv.lock</code> met de versies van de packages</li>
</ul>
<p>Het bevat daarnaast de volgende <strong>folders</strong>:</p>
<ul>
<li><code>_advanced</code> en <code>_basic</code> met de rapporten die bij een automatische rendering worden gemaakt in twee varianten.</li>
<li><code>_extensions</code> met Quarto extensions voor pandoc</li>
<li><code>_freeze</code> met elementen die onveranderd zijn en worden hergebruikt</li>
<li><code>_output</code> met rapporten per faculteit en opleiding</li>
<li><code>bibiograhy</code> met referenties</li>
<li><code>brand</code> met de huisstijlbestanden (logo’s, kleuren, lettertypes, opmaak in scss)</li>
<li><code>docs</code> voor de documentatiebestanden (README en NEWS)</li>
<li><code>R/data</code> met algemene datasets</li>
<li><code>R/functions</code> met .R-bestanden voor verschillende soorten functies</li>
<li><code>R/images</code> met afbeeldingen</li>
<li><code>R/qmd</code> met .qmd-bestanden die worden ingesloten (tekst snippets)</li>
<li><code>R/scripts</code> met .R-bestanden die worden ingesloten (UITWERKEN)</li>
<li><code>R/vars</code> met de datadictonary van de variabelen</li>
<li><code>renv</code> voor de packages uit de R omgeving</li>
</ul>
<p><strong>NB Git ignore</strong></p>
<ul>
<li>Het <code>.gitignore</code> bestand is zo ingericht dat folders die specifieke output bevatten niet meegaan naar de repo (bijv. <code>_log</code>, <code>_test</code> en <code>_graveyard</code>).</li>
</ul>
</section>
<section id="vooraf" class="level2">
<h2 class="anchored" data-anchor-id="vooraf">Vooraf</h2>
<ul>
<li>Run voordat je dit template gebruikt 1x <code>_Setup.R</code> door op ‘Source’ te klikken.</li>
<li>Je krijgt nu bericht welke libraries je nog moet installeren.</li>
<li>Start nadat de installatie klaar is een nieuwe sessie.</li>
</ul>
</section>
<section id="gebruik-van-dit-template" class="level2">
<h2 class="anchored" data-anchor-id="gebruik-van-dit-template">Gebruik van dit template</h2>
<p>Als je het template voor de eerste keer gebruikt, doorloop dan na het runnen van <code>_Setup.R</code> de volgende stappen:</p>
<ul>
<li>Configuratie
<ul>
<li>Pas de instellingen in <code>_quarto.yml</code> aan naar de wensen van je project.</li>
<li>Pas de instellingen in <code>_quarto-advanced.yml</code> en <code>_quarto-basic.yml</code> aan naar de wensen van je project. [Verder uitwerken]</li>
</ul></li>
</ul>
</section>
<section id="opbouw-van-individuele-bestanden" class="level2">
<h2 class="anchored" data-anchor-id="opbouw-van-individuele-bestanden">Opbouw van individuele bestanden</h2>
<section id="index" class="level3">
<h3 class="anchored" data-anchor-id="index">Index</h3>
<p>Het bestand index.qmd moet bestaan als je in Quarto een book template gebruikt; index.qmd is opgebouwd uit de volgende onderdelen:</p>
<ul>
<li>De <strong>YAML header</strong> met:
<ul>
<li><code>subtitle</code>: de ondertitel. Een deel hiervan stel je in via de <code>params</code> verder in het yml bestand. Door <code>params</code> te gebruiken wordt de ondertitel automatisch aangepast als je het bestand rendert.</li>
<li><code>params</code> met opties voor de opleiding en het rapport:
<ul>
<li><code>versie</code>: de versie van het rapport</li>
<li><code>succes</code>: het soort succes waarvoor we een fairness analyse maken (bijv. Retentie na 1 jaar, Retentie na 2 jaar, etc.)</li>
<li><code>model</code>: de naam van het model. Dit kan dezelfe naam hebben als de succes parameter.</li>
<li><code>use_synthetic_data</code>: of je gebruik maakt van synthetische data (false of true)</li>
<li><code>recreateplots</code>: of je de plots opnieuw wilt maken (false of true)</li>
<li><code>faculteit</code>: de faculteit waarvoor het rapport wordt gemaakt</li>
<li><code>opleidingsnaam</code>: de volledige naam van de opleiding</li>
<li><code>opleiding</code>: de code van de opleiding</li>
<li><code>opleidingsvorm</code>: de opleidingsvorm voluit (voltijd, deeltijd, duaal)</li>
<li><code>opleidingsvorm_afkorting</code>: de opleidingsvorm afgekort (VT, DT, DU)</li>
<li><code>instroomselectie</code>: of de opleiding een instroomselectie heeft (false of true) - op basis hiervan wordt variabele <code>Rank</code> ingesloten of niet.</li>
</ul></li>
<li><code>includes</code> met opties om onderdelen van pagina’s wel of niet te tonen
<ul>
<li><code>inleiding</code>: toon wel of niet de inleiding</li>
<li><code>data</code>: ??</li>
<li><code>model_lr</code>: bouw wel of niet het lineaire regressiemodel</li>
<li><code>model_rf</code>: bouw wel of niet het random forest model</li>
<li><code>model_svm</code>: bouw wel of niet het support vector machine model</li>
<li><code>final_fit</code>: toon wel of niet de final fit</li>
<li><code>conclusions</code>: toon wel of niet de conclusies</li>
<li><code>contact</code>: toon wel of niet de contactgegevens</li>
<li><code>justification</code>: toon wel of niet de verantwoording</li>
<li><code>copyright</code>: toon wel of niet de copyright informatie</li>
</ul></li>
<li>Doordat <code>_quarto.yml</code> altijd wordt uitgevoerd, hoeft er niet meer in de index te worden opgenomen
<ul>
<li>in <code>_quarto.yml</code> worden onder meer de datum van het bestand automatisch bepaald, maar ook de instellingen voor de HTML pagina.</li>
</ul></li>
</ul></li>
<li>De <strong>setup</strong> met de packages en opties via <code>_Setup.R</code>: zie de verder uitleg hieronder.</li>
<li>De <strong>opleidingsinformatie</strong> via R/qmd/header-studyprogram.qmd</li>
<li>De <strong>samenvatting van de kansengelijkheidsanalyse</strong> via R/qmd/equity-conclusions.qmd</li>
<li>De <strong>contact</strong> informatie via R/qmd/footer-contact.qmd - deze pagina kan wel of niet worden getoond</li>
<li>De <strong>copyright</strong> informatie via R/qmd/footer-copyright.qmd - deze pagina kan wel of niet worden getoond</li>
</ul>
</section>
<section id="setup.r" class="level3">
<h3 class="anchored" data-anchor-id="setup.r">_Setup.R</h3>
<ul>
<li><strong>_Setup.R mag niet aangepast worden</strong>.</li>
<li>Omdat de <code>setup</code> chunk uit de <code>index.qmd</code> niet goed gelezen wordt in ingesloten .qmd bestanden, is deze vervangen door een <code>_Setup.R</code> bestand dat wordt ingesloten in elke pagina.</li>
<li>Dit bestand wordt per sessie slechts 1x uitgevoerd; als er een nieuwe versie is terwijl je werkt aan je project, herstart dan je R omgeving voor een nieuwe sessie of pas de variabele <code>bReset_Setup &lt;- F</code> eenmalig aan naar <code>T</code>.</li>
<li>In <code>_Setup.R</code> vind je:
<ul>
<li>Een check op de omgeving: development of production</li>
<li>Instellingen voor packages en functies:
<ul>
<li>libraries + voorkeuren voor bepaalde functies bij conflicten</li>
<li>het inladen van fonts</li>
<li>het inladen van extra functies</li>
<li>het inladen van kleuren</li>
<li>het bepalen van het thema voor afbeeldingen</li>
<li>een voorkeur voor de tidymodels instellingen</li>
<li>algemene opties voor het renderen van knitr</li>
</ul></li>
<li>Configuratie voor:
<ul>
<li>bestandspaden</li>
<li>debug opties</li>
<li>gt-summary instellingen</li>
<li>default parameters voor de rapporten als $params niet bestaat</li>
<li>opleidingsinformatie</li>
<li>het inladen van de data</li>
<li>overige instellingen: onderzoeksinstellingen, de caption bij afbeeldingen, plotinstellingen</li>
</ul></li>
<li>Content instellingen:
<ul>
<li>de lange naam van de opleidings of faculteit</li>
<li>de variabelen en hun levels</li>
<li>de sensitieve variabelen (waarop fairness wordt onderzocht)</li>
<li>de outputpaden voor de data en de modellen</li>
<li>de instellingen voor de modellen</li>
<li>de data voor training, last fits and resultaten</li>
</ul></li>
</ul></li>
<li>Zie de inline documentatie voor de verdere toelichting.</li>
</ul>
</section>
<section id="quarto-yaml" class="level3">
<h3 class="anchored" data-anchor-id="quarto-yaml">Quarto YAML</h3>
<p>Het template werkt met twee profielen: <code>basic</code> en <code>advanced</code>. Het basic profiel bevat de conclusies, de fairness analyse en de factoren analyse. De advanced analyse bevat ook een hoofdstuk over de achterliggende voorspelmodellen, legt de achterliggende concepten uit en toont alle relevante R-code. Om dit te realiseren wordt gebruik gemaakt van drie bestanden: <code>_quarto-basic.yml</code>, <code>_quarto-basic.yml</code> en <code>_quarto-advanced.yml</code>. Het _quarto.yml bestand bevat de algemene instellingen voor beide rapporten; de andere twee bestanden bevatten de specifieke instellingen voor de basic en advanced rapporten.</p>
<p>Het <strong>_quarto.yml</strong> bestand heeft de volgende opties:</p>
<ul>
<li>De project instellingen (book) en bijbehorende details: auteur, datum (op basis van de laatste aanpassing), navigatie</li>
<li>De beide profielen: basic en advanced. Als geen profiel wordt opgegeven wordt het eerste profiel gebruikt.</li>
<li>De branding instellingen: de locatie van de huisstijlbestanden</li>
<li>De editor instellingen: werk met de brondcode</li>
<li>De executie instellingen: bewaar geen markdown files en toon niet de console output</li>
<li>De citatie instellingen: de locatie van de bibliografie en de Citation Style Language (apa)</li>
<li>De taal instellingen: de taal van het rapport</li>
<li>De lightbox instellingen: afbeeldingen worden uitvergroot als je erop klikt</li>
<li>De html instellingen: nummering, scrollen, de engine voor wiskundige teksten, de fontgrootte (110%), mogelijkheid voor commentaar (via hypothesis), het thema, de output instellingen, de inhoudsopgave en links onder ‘Meer informatie’.</li>
<li>Overige instellingen: configuratie</li>
</ul>
<p>Het <strong>_quarto-basic.yml</strong> bestand heeft de volgende opties:</p>
<ul>
<li>De naam van het project en de output-directory.</li>
<li>De specifieke thema instellingen: een eigen scss bestand.</li>
<li>De specifieke executie instellingen: bewaar bestanden die niet veranderd zijn (freeze); deze instelling zorgt ervoor dat bij het renderen een _freeze folder wordt aangemaakt met elementen die niet veranderen en worden hergebruikt in dit template.</li>
<li>De boek instellingen: de titel, de volgorde van de hoofdstukken en appendices. NB. Dit template verbergt hoofdstuk 4: de ontwikkeling van voorspelmodellen</li>
</ul>
<p>Het <strong>_quarto-advanced.yml</strong> bestand heeft de volgende opties:</p>
<ul>
<li>De naam van het project en de output-directory.</li>
<li>De specifieke thema instellingen: instellingen voor het tonen van R-code en het eigen scss bestand.</li>
<li>De specifieke executie instellingen: toon de uitkomsten van de R-chunks (echo: true). Dit template maakt geen gebruik van de freeze optie om te voorkomen dat te veel materiaal wordt hergebruikt.</li>
<li>De boek instellingen: de titel, de volgorde van de hoofdstukken en appendices. NB. Dit template toont juist wel hoofdstuk 4: de ontwikkeling van voorspelmodellen.</li>
</ul>
<p>Wil je meer leren over het gebruik van profielen? Bezoek dan de <a href="https://quarto.org/docs/projects/profiles.html">Quarto documentatie</a>.</p>
</section>
</section>
</section>
<section id="inhoud" class="level1">
<h1>Inhoud</h1>
<ul>
<li>Het prognosemodel is gebouwd met het <a href="https://www.tidymodels.org/">tidymodels</a> package uit de tidyverse. Een package dat volop wordt doorontwikkeld met een actieve ontwikkelaarsgroep.</li>
<li>Als je tidymodels wilt aanleren, volg dan eerst de <a href="https://www.tidymodels.org/start/">tutorials</a> en lees daarna het online boek: <a href="https://www.tmwr.org/">Tidy Modeling with R</a> .</li>
<li>We maken twee modellen (penalized lineaire regressie en random forest), naar verhouding weinig rekenkracht vragen en waarvan de variabelen en hun bijdrage aan het model bekend zijn (een <em>whitebox</em> model).</li>
<li>De werking van de modellen wordt – in advanced modus – uitgelegd in de tekst. Elk rapport is daarmee zelfstandig te lezen.</li>
<li>Het beste model wordt automatisch geselecteerd. Op basis van dat model trekken we conclusies over de kansengelijkheidsdynamiek in een opleiding.</li>
</ul>
<section id="bekende-issues" class="level2">
<h2 class="anchored" data-anchor-id="bekende-issues">Bekende issues</h2>
<ul>
<li>Geen</li>
</ul>
</section>
<section id="wensen" class="level2">
<h2 class="anchored" data-anchor-id="wensen">Wensen</h2>
<ul>
<li>Geen</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>