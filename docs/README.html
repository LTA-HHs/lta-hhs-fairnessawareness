<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap-973236bd072d72a04ee9cd82dcc9cb29.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="fairness-awareness-analysis-of-equity-in-education" class="level1">
<h1>Fairness Awareness: Analysis of Equity in Education</h1>
<p>Theo Bakker, The Hague University of Applied Sciences 2025-02-28</p>
<p><a name="top" href=""></a></p>
<!-- badges: start -->
<!-- badges: begin -->
<!-- [![](https://img.shields.io/github/last-commit/LTA-HHs/lta-hhs-tidymodels-studiesucces.svg)](https://github.com/LTA-HHs/lta-hhs-tidymodels-studiesucces/commits/main) -->
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" class="img-fluid"></a> <a href="https://cran.r-project.org/web/licenses/Attribution-ShareAlike%204.0%20International"><img src="https://img.shields.io/badge/license-Attribution--ShareAlike%204.0%20International-blue.svg" class="img-fluid" alt="License: Attribution-ShareAlike 4.0 International"></a></p>
<!-- badges: end -->
<p><img src="figures/fairness-awareness-hex.png" align="right" height="160"></p>
<p>This <a href="https://community-data-ai.npuls.nl/groups/view/44d20066-53a8-48c2-b4e9-be348e05d273/project-center-for-educational-data-analytics-ceda" target="_blank">Npuls CEDA</a> <sup>🔗</sup> project makes it possible to create a fairness analysis to study equity (<em>kansengelijkheid</em>) within progression of students in educational institutions in The Netherlands (mbo, hbo, and wo).</p>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#-about">About</a></li>
<li><a href="#why-we-study-fairness-awareness-and-equity">Why we study fairness, awareness, and equity</a></li>
<li><a href="#-getting-started">Getting started</a>
<ul>
<li><a href="#prerequisites-for-stand-alone-installations">Prerequisites for stand-alone installations</a></li>
<li><a href="#prerequisites-for-posit-cloud-installations">Prerequisites for Posit Cloud installations</a></li>
<li><a href="#installing">Installing</a></li>
</ul></li>
<li><a href="#-rendering-your-fairness-reports">Rendering your fairness reports</a></li>
<li><a href="#-deployment">Deployment</a></li>
<li><a href="#-learn-more-on-fairness-awareness-and-equity">Learn more on fairness, awareness, and equity</a></li>
<li><a href="#-built-with">Built with</a></li>
<li><a href="#-contributing">Contributing</a> <!-- - [Versioning](#versioning) --></li>
<li><a href="#-authors">Authors</a></li>
<li><a href="#-license">License</a></li>
<li><a href="#-acknowledgments">Acknowledgments</a></li>
<li><a href="#-known-issues">Known issues</a></li>
<li><a href="#-wished">Wishes</a></li>
<li><a href="#-contact">Contact</a></li>
</ul>
</section>
<section id="about" class="level2">
<h2 class="anchored" data-anchor-id="about">🎓 About</h2>
<p>This R project offers Dutch educational institutions a template for creating a <strong>fairness analysis of students’ progression in educational institutions in The Netherlands</strong>. The template is based on the <a href="https://quarto.org/docs/get-started/" target="_blank">Quarto</a> <sup>🔗</sup> framework and uses the <a href="https://www.tidyverse.org/" target="_blank">Tidyverse</a> <sup>🔗</sup> coding standard. The template is developed by the <a href="https://www.dehaagsehogeschool.nl/onderzoek/lectoraten/learning-technology-analytics" target="_blank">Learning Technology &amp; Analytics (LTA)</a> <sup>🔗</sup> research group of The Hague University of Applied Sciences for the <a href="https://community-data-ai.npuls.nl/groups/view/44d20066-53a8-48c2-b4e9-be348e05d273/project-center-for-educational-data-analytics-ceda" target="_blank">Npuls CEDA</a> <sup>🔗</sup> project.</p>
<p>You will have the option to build two reports. The <em>advanced fairness report</em> you will build, will look like this:</p>
<p><img src="figures/screenshot-advanced-report.png" align="center" height="300" style="border: 1px solid #999999"></p>
<p><br> The <em>basic fairness report</em> you will build, will look like this:</p>
<p><img src="figures/screenshot-basic-report.png" align="center" height="300" style="border: 1px solid #999999"></p>
</section>
<section id="why-we-study-fairness-awareness-and-equity" class="level2">
<h2 class="anchored" data-anchor-id="why-we-study-fairness-awareness-and-equity">💡 Why we study fairness, awareness, and equity</h2>
<p>The Fairness Awareness Template is based on the concepts of Fairness, Awareness, and Equity. These concepts are essential for the development of a fair educational system. If we don’t study the fairness of our institutions, we can’t be aware of the consequences of our actions in policy, education or student counseling. If we are not aware of the consequences of our actions, we can’t transform unfair educational systems.</p>
<p>We use machine learning (ML) models to understand if there is bias in the progression of students in educational institutions. The fairness of an ML model can be assessed by examining the quality of its predictions for different groups of students expressed in fairness metrics. If the differences in predictions are disproportionally large, this is a sign of bias within the data, unfairness for some groups of students, and inequity.</p>
<p>To learn more about the concepts of Fairness, Awareness, and Equity, read the inaugural speech <a href="https://zenodo.org/records/14204674" target="_blank">No Fairness without Awareness</a> <sup>🔗</sup> by Theo Bakker.</p>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">🚀 Getting started</h2>
<p>These instructions will get you a copy of the project up and running on your local machine for development and testing. See the <a href="#deployment">deployment</a> for notes on deploying the project on a live system.</p>
<section id="prerequisites-for-stand-alone-installations" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-for-stand-alone-installations">Prerequisites for stand-alone installations</h3>
<p>To start working with this project, make sure you have the following software installed following the links provided, unless you use a paid version of Posit Cloud:</p>
<p><strong>R, Rstudio, Quarto, XQuartz (for Mac only)</strong></p>
<ul>
<li>RStudio version 2024.12.0 or higher with R version 4.4.2 or higher - <a href="https://posit.co/download/rstudio-desktop/" target="_blank">Posit</a> <sup>🔗</sup></li>
<li>XQuartz 2.8.5 or higher (for Mac only) - <a href="https://www.xquartz.org/" target="_blank">XQuartz</a> <sup>🔗</sup></li>
<li>Quarto version 1.6.39 or higher - <a href="https://quarto.org/docs/get-started/" target="_blank">Quarto</a> <sup>🔗</sup>. Since we use the latest Quarto functionalities, you will need at least this version.</li>
</ul>
<p><strong>Github, GitHub Desktop</strong></p>
<ul>
<li>A Github account and (optionally) GitHub Desktop version 3.4.16 - <a href="https://docs.github.com/en/desktop/installing-and-authenticating-to-github-desktop/installing-github-desktop" target="_blank">Github</a> <sup>🔗</sup></li>
</ul>
<p><strong>GFortran</strong></p>
<ul>
<li>GFortran - <a href="https://fortran-lang.org/learn/os_setup/install_gfortran/" target="_blank">Fortran</a> <sup>🔗</sup>. Fortran is needed to work with several machine-learning packages. Installation will take several minutes. You might have to restart your computer after installation.</li>
</ul>
<p><strong>R packages, fonts</strong></p>
<ul>
<li>Other packages are installed automatically by running the project on your local machine. Instructions are below.</li>
<li>The installation of the Liter font is optional. Follow the instructions from Google to install this font. - <a href="https://fonts.google.com/specimen/Liter" target="_blank">Google</a> <sup>🔗</sup></li>
</ul>
</section>
<section id="prerequisites-for-posit-cloud-installations" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-for-posit-cloud-installations">Prerequisites for Posit Cloud installations</h3>
<ul>
<li>Login into Posit Cloud and create a <code>New Project from Git Repository</code>.</li>
<li>Copy and paste the following url https://github.com/LTA-HHs/lta-hhs-fairnessawareness/. That’s it.</li>
</ul>
</section>
<section id="installing" class="level3">
<h3 class="anchored" data-anchor-id="installing">Installing</h3>
<ol type="1">
<li>First, make a fork of the repository to your own Github account. A fork is a copy of the original repository you create in your own GitHub account. This allows you to modify it independently without affecting the original project. Then clone the repository to your local machine using for instance GitHub Desktop. See <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository" target="_blank">Cloning a repository</a> <sup>🔗</sup> for an explanation.</li>
<li>Once you have cloned the repository, open the project in RStudio and run the <code>_Setup.R</code> file by clicking on <code>Source</code>. Don’t change any settings yet. This action will install all the necessary packages and fonts. This installation process will take about 5-10 minutes.</li>
<li>Ignore any inline suggestions at the top of R Studio to install missing packages. Click on <code>Don't show again</code></li>
<li>When presented with the following question, choose 1.</li>
</ol>
<pre class="plaintext"><code>It looks like you've called renv::restore() in a project that hasn't been activated yet.
How would you like to proceed? 

1: Activate the project and use the project library.
2: Do not activate the project and use the current library paths.
3: Cancel and resolve the situation another way.</code></pre>
<ol start="5" type="1">
<li>Your session will restart. Run the <code>_Setup.R</code> file by clicking on <code>Source</code>.</li>
<li>Answer all questions about installations with Yes (Y or y).</li>
<li>Once you have all the packages installed, it is best to restart your R session.</li>
</ol>
</section>
</section>
<section id="rendering-your-fairness-reports" class="level2">
<h2 class="anchored" data-anchor-id="rendering-your-fairness-reports">📚 Rendering your fairness reports</h2>
<ul>
<li>Follow the <a href="TUTORIAL.md">Tutorial</a> to learn more about why we study fairness, and how to create and render your institutional fairness reports.</li>
</ul>
</section>
<section id="built-with" class="level2">
<h2 class="anchored" data-anchor-id="built-with">🔨 Built with</h2>
<ul>
<li><a href="https://quarto.org/docs/get-started/" target="_blank">Quarto</a> <sup>🔗</sup> - The web framework used with
<ol start="18" type="A">
<li></li>
</ol></li>
<li><a href="https://www.tidyverse.org/" target="_blank">Tidyverse</a> <sup>🔗</sup> - The R coding standard used.</li>
<li><a href="https://www.tidymodels.org/" target="_blank">Tidymodels</a> <sup>🔗</sup> - The R package used to build the prediction models.</li>
<li><a href="https://dalex.drwhy.ai/" target="_blank">Dalex</a> <sup>🔗</sup> - The R package used to explain the prediction models and create the fairness analysis. The implementation of the fairness analysis is based on the <a href="https://fairness.drwhy.ai/" target="_blank">Fairness</a> <sup>🔗</sup> package.</li>
</ul>
<p>The LTA-HHs team adjusted the Dalex implementation to improve usability and make it suitable for use in the educational sector in the Netherlands.</p>
</section>
<section id="contributing" class="level2">
<h2 class="anchored" data-anchor-id="contributing">🔧 Contributing</h2>
<p>In the next version of this template, we will explain how you can contribute to this project. Until then, please get in touch with Theo Bakker if you have any suggestions.</p>
<!-- ## 🔩 Versioning -->
<!-- We use [SemVer](http://semver.org/) for versioning. See the [tags on this repository](https://github.com/LTA-HHs/lta-hhs-fairnessawareness/tags) for the available versions.  -->
</section>
<section id="authors" class="level2">
<h2 class="anchored" data-anchor-id="authors">✒️ Authors</h2>
<ul>
<li><strong>Theo Bakker</strong>, Professor of Learning Technology &amp; Analytics of The Hague University of Applied Sciences (THUAS), t.c.bakker@hhs.nl - <em>Initial work</em> - <a href="https://github.com/tcbakker" target="_blank">Theo Bakker</a> <sup>🔗</sup> and <a href="https://github.com/LTA-HHs" target="_blank">LTA-HHs</a> <sup>🔗</sup></li>
</ul>
</section>
<section id="license" class="level2">
<h2 class="anchored" data-anchor-id="license">🚦 License</h2>
<p>This project is licensed under the <a href="LICENSE.md">Creative Commons Attribution Share Alike 4.0 International</a>.</p>
</section>
<section id="acknowledgments" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgments">🔆 Acknowledgments</h2>
<ul>
<li>We want to thank the developers of Quarto, Tidyverse, Tidymodels and Dalex for their excellent work.</li>
<li>We want to thank Npuls and CEDA for their support in developing and testing this template.</li>
</ul>
</section>
<section id="known-issues" class="level2">
<h2 class="anchored" data-anchor-id="known-issues">📌 Known issues</h2>
<ul>
<li>None</li>
</ul>
</section>
<section id="wishes" class="level2">
<h2 class="anchored" data-anchor-id="wishes">📎 Wishes</h2>
<ul>
<li>Be able to include logo in _brand.yml for subsequent use in basic.scss.</li>
<li>Remove Warnings while rendering .qmd files without parameters</li>
</ul>
</section>
<section id="contact" class="level2">
<h2 class="anchored" data-anchor-id="contact">📫 Contact</h2>
<p>If you have any questions or suggestions, please contact the author of this template: <a href="mailto:t.c.bakker@hhs.nl">Theo Bakker</a></p>
<p><em>To the <a href="NEWS.md">version history of the template</a>.</em></p>
<p><a href="#top">Back to top</a></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>