## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## Log.txt ####
## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## R code voor lectoraat LTA De Haagse Hogeschool
## Copyright 2024 De HHs
## Web Page: http://www.hhs.nl
## Contact: Theo Bakker (t.c.bakker@hhs.nl)
## Verspreiding buiten De HHs: Nee
##
## Doel: Aanpassingen in het project bijhouden
##
## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## Geschiedenis:
## 28-04-2024: TB: Aanmaak bestand
## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## TODO / WERKVOORRAAD ####
## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

[ ] Plots
  [ ] Plots bewaren - als ze niet bestaan, anders inlezen of met parameter opnieuw maken
    [ ] Omzetten naar een handige functie
    [ ] Naam moet ook analyses bevatten
    [ ] Opslag zoals bij bbc in plots project

[ ] Queries/plots
  [ ] Studentpersonas_opleidingen > opheffen en naar functies brengen

[/] Studenten
  [ ] Violin plot maken voor algemene student
    [ ] Breakdown violin - https://ema.drwhy.ai/breakDown.html
  [x] Prototype bestanden van studenten toevoegen
  [x] Modellen opslaan en in een 1e pagina de explainer toepassen
  [/] Ook maken voor:
    [x] geslacht 
    [x] aansluiting 
    [ ] leeftijd vooropleiding
    [ ] SES

[x] Breakdown plot
  [ ] labels voor Intercept en Voorspelling vet maken
    
[ ] Overige analyses
  [ ] Shapley values uitproberen https://ema.drwhy.ai/shapley.html
  [ ] Ceteris Paribus uitproberen https://ema.drwhy.ai/ceterisParibus.html
  [ ] Partial Dependence plots uitproberen https://ema.drwhy.ai/partialDependenceProfiles.html
  [ ] Modellen - interactie-effecten toevoegen?

[ ] Dalex
  [x] explainer - https://modeloriented.github.io/DALEXtra/reference/explain_tidymodels.html

[ ] Warnings
  [x] Levels aanpassen aan wat er in de dataset set

[ ] Modellen
  [ ] Diplomarendement
  [x] Uitval met en zonder prop
    [x] SUC_P_aantal_jaar
  [ ] Aan het begin een klein staatje van het aantal uitval per jaar.
  
[ ] Andere opleidingen proberen
  [ ] ORM_DT
      [select_inspect_data]    
      [ ] te weinig observaties ondervangen
        [ ] voeg per opleiding het aantal eerstejaars toe en unieke collegejaren.
        [ ] als dit te weinig observaties of jaren zijn, dan next

[ ] Plot
  [ ] de beste plot in de auc tonen: If performance is about the same, 
  we’d prefer to choose a higher penalty value. zie https://www.tidymodels.org/start/case-study/

[ ] Teksten
  [ ] Beste model fits zoals op https://rpubs.com/mikek25/tidymodels_churn
  [ ] Teksten voor conclusies herzien
  
  [ ] Een workflow set uitproberen:
    [ ] https://workflowsets.tidymodels.org/

## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## GEDAAN ####
## +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

[x] Breakdown plot
    [x] prediction > op laatste plek zetten
    [x] getallen afronden op 1
    [x] lump als de bijdrage 0 is
    [x] kleuren toekennen op basis van + of min
    [x] waarde van overige is niet goed
    [x] labels toevoegen >> in % omzetten
    [x] intercept laten lopen van 0 naar de intercept
    [x] balkje van prediction laten lopen van intercept naar prediction
    [x] tekst van - beter uitlijnen
    [x] kleuren van min en plus verbeteren
    [x] positie van tekst is niet goed

[x] Splitsen van de algemene pagina en verdiepende analyses
  [x] Bewaar final fits
  [x] Maak nieuwe pagina voor verdiepende analyse

[x] Extra variabelen
  [x] Wiskundecijfer -    VOP_Cijfer_SE_proxy_wiskunde
  [x] Natuurkundecijfer - VOP_Cijfer_schoolexamen_natuurkunde
  [x] Nederlands -        VOP_Cijfer_schoolexamen_Nederlands
  [x] Engels -            VOP_Cijfer_schoolexamen_Engels
  [x] Wel of geen cijfer
    [x] Wiskunde_Ja_Nee
    [x] Natuurkunde_Ja_Nee
    [x] Cijfer Ja_Nee
    [x] Engels_Ja_Nee
    [x] Nederlands_Ja_Nee

[x] Andere opleidingen proberen
  [x] ITD: CMD
  [x] TIS: IPO
  [x] GVS: BT/MT
  [x] SWE: SW
  [x] BRV: OR DT
  [x] BFM: AC

[-] 3 extra modellen: 
    [-] mgcv = general additive model 
    [-] svm = support vector machine 
    [-] boost_tree_xgboost
    [-] decision tree
  
[-] Structuur/herhaalbaarheid
  [-] Algehele opzet wat meer configureerbaar?
    [-] op basis van https://rpubs.com/mikek25/tidymodels_churn
    [-] parallel processing toevoegen
  [-] https://forum.posit.co/t/error-in-tidymodels-tune-grid-function-call/54150
  
[x] Waarschijnlijk werkt de final fit niet goed bij lr
[x] Dubbele studie > omkatten naar Ja / Nee

[x] Corplot voor hoge correlaties  
  

[x] Meer variabelen?
    [x] Bij HDT: RNK_Rangnummer
    [x] BUI_Internationale_student_tf
    [x] > GIS - is dit mijn variabele of die van OKC?
    [x] SES_Deelscore_arbeid
    [-] SES_Deelscore_opleiding
    [x] SES_Deelscore_welvaart
    [x] VOP_Gemiddeld_cijfer_cijferlijst
    
[x] Teksten
  [x] Conclusies ook configureren
  
[x] Plots  
  [x] De VIP plot kan een stuk beter: kleuren en met aantallen als labels  

[x] Warning: `validation_split()` was deprecated in rsample 1.2.0. ℹ Please use `initial_validation_split()` instead.

[x] Modellen
  [x] rf: uitzoeken hoe we mtry en min_n bepalen
  [-] Grouped model (op basis van vooropleiding met of zonder cijfer)
  
  [x] Het finale model kunnen kiezen op basis van de beste hyperparameters
    [x] Hoogste auc bepalen
    [x] Wisselen van tekst als het model anders is (voorbeeldopleiding hiervoor vinden)
  
  [x] Opties
    [x] Elk model aan of uit kunnen zetten
    [x] Aan het eind van een model de resultaten in een df zetten 
    [x] Dit df gebruiken voor teksten
    [x] Rekening houden met de teksten

[x] Variabelen
  [x] Eindexamencijfer toevoegen
  [x] Reistijd toevoegen 
  [x] Impute missing values voor SES > als stap in de pipeline uitgeprobeerd, maar geeft problemen
  [x] Verwijder hoog gecorreleerde plots >> geeft problemen en kan alleen met glmnet/lr; voorlopig niet
  [x] https://stackoverflow.com/questions/69074437/verify-model-assumptions-with-tidymodels
  [x] Titel bepalen door params
  [x] Ondertitel bepalen door params
  [x] Op basis van soort uitval ook de html outputfile aanpassen

[x] Modellen
  [-] In de split rekening houden met Collegejaren: het laatste jaar moet eigenlijk de validatieset zijn
  [-] predict; zie https://www.tidymodels.org/start/recipes/
  [x] uitval na 2 jaar kunnen instellen
  
[x] Teksten
  [x] tekst van de conclusies automatisch genereren
  [x] Sensitivity en 1-Specificity toelichten
  [x] beter of slechter teksten automatisch genereren
  [-] Kleurtje voor de conclusies
  [x] Meer duiding bij samenstelling van de groepen > one table?
  [x] Bij een basemodel lager dan 50% andere tekst.

[x] Tables
  [x] Naast N ook % bij TRUE/FALSE
  [x] TRUE/FALSE vervangen door Ja/Nee
  [x] Sorteer volgorde skp in lijn met profielen van havo/vwo en mbo

[x] Plots  

[x] Output/Layout
  [x] Ipv Table of Contents: Inhoudsopgave
    [x] Links naar pagina's van het lectoraat
  [x] Logo's van HHs en GIL
  [-] Standaardtekst over LTA met copyright
  [-] Output naar een aparte folder
  [x] Een algemene footer met copyright

[x] Project
  [x] Index vereenvoudigen door met includes te werken voor de R code
  [x] Includes voor delen van de index

[x] Meerdere opleidingen
  [x] dfOpleidingen gebruiken voor het ophalen van basisinformatie
      [x] params zetten en dan met behulp van 
        [x] rmarkdown::render("document.qmd", params = list(titel = "Nieuwe Titel")) (ChatGPT) >
        eigen functie gevonden en die toegepast;
        [-] eventueel met post render iets doen: https://github.com/quarto-dev/quarto-cli/discussions/5261
