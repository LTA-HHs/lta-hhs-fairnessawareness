<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Theo Bakker, lector Learning Technology &amp; Analytics, De HHs">
<meta name="dcterms.date" content="2024-07-08">

<title>Prognosemodel retentie na 1 jaar (Gewogen) - Fairness</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/clipboard/clipboard.min.js"></script>
<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/quarto.js"></script>
<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/popper.min.js"></script>
<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/anchor.min.js"></script>
<link href="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="GS_H3_Index_verdieping_kansengelijkheid_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="GS_H3_Index_verdieping_kansengelijkheid_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="GS_H3_Index_verdieping_kansengelijkheid_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="GS_H3_Index_verdieping_kansengelijkheid_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prognosemodel retentie na 1 jaar (Gewogen) - Fairness</h1>
<p class="subtitle lead">BRV | B Bestuurskunde Overheidsmanagement (BO) - duaal - versie 1.0</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Theo Bakker, lector Learning Technology &amp; Analytics, De HHs </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- Title -->
<section id="sec-kansengelijkheid" class="level1">
<h1>Analyse van kansengelijkheid</h1>
<!-- Inleiding -->
<section id="inleiding" class="level2">
<h2 class="anchored" data-anchor-id="inleiding">Inleiding</h2>
<p>Na de factoranalyse van de data gaan we nu in op de onderwerpen bias, fairness en kansengelijkheid. Het doel is beter te begrijpen of er studenten zijn met minder kans op succes en of dit disproportioneel is. Dit kan duiden op kansenongelijkheid.</p>
<p>De analyse van kansengelijkheid heeft de volgende stappen:</p>
<ol type="1">
<li>We lezen de bewerkte dataset weer in en de modellen die we in de basis-analyse hebben gemaakt.</li>
<li>We maken weer een <em>explainer</em> om de modellen beter te begrijpen en te kunnen uitleggen.</li>
<li>Vervolgens berekenen we of er <em>bias</em> bestaat voor verschillende groepen studenten naar geslacht, vooropleiding en vorm van aansluiting. We analyseren daarvooor de verdeling van kansen en mate van fairness in het voorspelmodel dat we hebben ontwikkeld.</li>
</ol>
<!-- Data -->
</section>
<section id="voorbereidingen" class="level2">
<h2 class="anchored" data-anchor-id="voorbereidingen">Voorbereidingen</h2>
<section id="laad-de-data" class="level3">
<h3 class="anchored" data-anchor-id="laad-de-data">Laad de data</h3>
<p>We laden de bewerkte data en het beste prognosemodel in voor:</p>
<p><strong>Opleiding</strong>: BRV | B Bestuurskunde Overheidsmanagement (BO), duaal, eerstejaars - <strong>Retentie na 1 jaar</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bepaal de paden</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sData_outputpath         <span class="ot">&lt;-</span> <span class="fu">Get_Model_Outputpath</span>(<span class="at">mode =</span> <span class="st">"data"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>sFittedmodels_outputpath <span class="ot">&lt;-</span> <span class="fu">Get_Model_Outputpath</span>(<span class="at">mode =</span> <span class="st">"last-fits"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sModelresults_outputpath <span class="ot">&lt;-</span> <span class="fu">Get_Model_Outputpath</span>(<span class="at">mode =</span> <span class="st">"modelresults"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Laad de data voor de opleiding: data, last fits en model results</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>dfOpleiding_inschrijvingen <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(sData_outputpath, <span class="at">trust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>lLast_fits                 <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(sFittedmodels_outputpath, <span class="at">trust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>dfModel_results            <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(sModelresults_outputpath, <span class="at">trust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pas de Retentie variabele aan naar numeric (0/1), </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># zodat er een explainer van gemaakt kan worden</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>dfOpleiding_inschrijvingen<span class="sc">$</span>Retentie <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfOpleiding_inschrijvingen<span class="sc">$</span>Retentie) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Maak een lijst van dfPersonas</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>lDfPersona <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop over de variabelen</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>lDfPersona <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="st">"Geslacht"</span>, <span class="st">"Vooropleiding"</span>, <span class="st">"Aansluiting"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">~</span> <span class="fu">Get_dfPersona</span>(.x)) <span class="sc">|&gt;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"Geslacht"</span>, <span class="st">"Vooropleiding"</span>, <span class="st">"Aansluiting"</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Laad de persona's</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>dfPersona_all <span class="ot">&lt;-</span> <span class="fu">Get_dfPersona</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maak-een-explainer" class="level3">
<h3 class="anchored" data-anchor-id="maak-een-explainer">Maak een explainer</h3>
<p>We maken weer gebruik van de explainer van <code>DALEX</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extraheer het fitted model en de workflow</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fitted_model <span class="ot">&lt;-</span> last_fit <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>workflow <span class="ot">&lt;-</span> last_fit <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Maak een explainer</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>explain_lf <span class="ot">&lt;-</span> DALEXtra<span class="sc">::</span><span class="fu">explain_tidymodels</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> workflow,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dfOpleiding_inschrijvingen <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Retentie),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> dfOpleiding_inschrijvingen <span class="sc">|&gt;</span> <span class="fu">pull</span>(Retentie),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">colorize =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Linear Regression"</span>, </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> dfOpleiding_inschrijvingen<span class="sc">$</span>Gewicht</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Kansengelijkheid -->
</section>
</section>
<section id="analyse-van-kansengelijkheid" class="level2">
<h2 class="anchored" data-anchor-id="analyse-van-kansengelijkheid">Analyse van kansengelijkheid</h2>
<p>Tot slot onderzoeken we kansengelijkheid door te kijken naar bias in de data. Dit wordt ook wel een <em>fairness analyse</em> genoemd. Het leidende werk voor fairness analyses is <a href="https://fairmlbook.org/pdf/fairmlbook.pdf"><em>Fairness and Machine Learning: Limitations and Opportunities</em></a> <span class="citation" data-cites="Barocas.2023">[@Barocas.2023]</span>. De methode die we in dit deel van de analyse hanteren is op dit gedachtengoed gebaseerd.</p>
<p>We onderzoeken of er bias bestaat voor verschillende groepen studenten als mogelijk teken van kansenongelijkheid. Ook hiervoor maken we gebruik van de <code>DALEX</code> explainer en onderzoeken de invloed van de variabelen op de kans op retentie voor verschillende groepen studenten naar geslacht, vooropleiding en aansluiting.</p>
<p>De volgende <strong>definities</strong> zijn van belang:</p>
<ul>
<li><strong>Bevoorrechte groep</strong>: Een groep die als standaard wordt beschouwd en mogelijk bevoordeeld wordt (bijv. meerderheidsgroepen, mannen, etc.).</li>
<li><strong>Beschermde groep</strong>: Een groep waarvan wordt verwacht dat deze mogelijk benadeeld wordt (bijv. minderheidsgroepen, vrouwen, etc.).</li>
</ul>
<p>In een onderwijssituatie kunnen deze groepen verschillen van andere maatschappelijke situatie. Zo hebben vrouwen in het onderwijs vaak een bevoorrechte positie omdat zij over het algemeen meer studiesucces hebben, terwijl in andere domeinen, bijvoorbeeld het vinden van werk, vrouwen vaak een beschermde groep zijn.</p>
<section id="ratios-om-kansengelijkheid-te-beoordelen" class="level3">
<h3 class="anchored" data-anchor-id="ratios-om-kansengelijkheid-te-beoordelen">Ratio’s om kansengelijkheid te beoordelen</h3>
<p>Voor elke groep onderzoeken we <strong>5 ratio’s</strong>, ook wel maatstaven of metrieken genoemd. Deze ratio’s zijn afgeleid van verhoudingen in de confusion matrix; ze geven inzicht in de mate van bias en kansengelijkheid vanuit verschillende perspectieven van een prognosemodel. <img src="01.%20Includes/img/confustion-matrix-fairness-lta-hhs.png" class="img-fluid"></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">1. Accuracy Equality</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">2. Equal Opportunity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">3. Predictive Equality</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">4. Predictive Parity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">5. Statistical Parity</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><span style="     color: rgba(0, 178, 205, 255) !important;"><strong>1. Accuracy Equality Ratio</strong></span></p>
<p><em>In welke mate voorspelt het model zowel de positieve als negatieve uitkomsten goed?</em></p>
<p>Deze maatstaf wordt gebruikt om te beoordelen of een model even accuraat is voor verschillende subgroepen binnen de dataset. Het vergelijkt de nauwkeurigheid van het model voor een beschermde groep (een minderheidsgroep) met de nauwkeurigheid voor een bevoorrechte groep (de meerderheidsgroep). Deze ratio wordt berekend als de verhouding tussen de nauwkeurigheid voor de beschermde groep en de nauwkeurigheid voor de bevoorrechte groep.</p>
<p><strong>Formule</strong></p>
<p><span class="math display">\[ \text{ACC} = \frac{TP + TN}{TP + FP + TN + FN} \]</span></p>
<p><strong>Definities</strong></p>
<ul>
<li><strong>Nauwkeurigheid (Accuracy)</strong>: Het percentage correcte voorspellingen van het model. Dit wordt berekend als het aantal juiste voorspellingen gedeeld door het totale aantal voorspellingen.</li>
</ul>
<p><strong>Interpretatie</strong></p>
<ul>
<li><strong>Ratio = 1</strong>: Het model is even accuraat voor beide groepen.</li>
<li><strong>Ratio &lt; 1</strong>: Het model is minder accuraat voor de beschermde groep dan voor de bevoorrechte groep, wat wijst op mogelijke bias tegen de beschermde groep.</li>
<li><strong>Ratio &gt; 1</strong>: Het model is meer accuraat voor de beschermde groep dan voor de bevoorrechte groep, wat ook op een vorm van bias kan wijzen, maar in het voordeel van de beschermde groep.</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><span class="example">Stel dat we retentie voor havisten (bevoorrecht) en mbo-ers (beschermd) voorspellen en de nauwkeurigheid van het model voor havisten 80% is en voor mbo-ers 70%. De Accuracy Equality Ratio is dan 0,875 (70% / 80%). Dit betekent dat het model minder accuraat is voor de beschermde groep (mbo-ers) dan voor de bevoorrechte groep (havisten).</span></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><span style="     color: rgba(0, 178, 205, 255) !important;"><strong>2. Equal Opportunity Ratio</strong></span></p>
<p><em>In welke mate zijn de terecht positieve voorspellingen gelijk?</em></p>
<p>Deze maatstaf beoordeelt de gelijkheid van kansen die een model biedt aan verschillende subgroepen in termen van de ‘True Positive Rate’ (TPR). Het vergelijkt de kans dat een model correct een positieve uitkomst voorspelt voor een beschermde groep versus een bevoorrechte groep.</p>
<p>De True Positive Rate (TPR) wordt ook wel de <strong>gevoeligheid</strong> (sensitivity of recall) genoemd. De Equal Opportunity Ratio wordt berekend als het aantal true positives gedeeld door het totaal aantal werkelijke positives.</p>
<p><strong>Formule</strong></p>
<p><span class="math display">\[ \text{TPR} = \frac{TP}{TP + FN} \]</span></p>
<p><strong>Definities</strong></p>
<ul>
<li><strong>TP</strong>: True Positives (correcte voorspellingen van positieve uitkomsten)</li>
<li><strong>FN</strong>: False Negatives (werkelijke positieve uitkomsten die foutief als negatief zijn voorspeld)</li>
</ul>
<p><strong>Interpretatie</strong></p>
<ul>
<li><strong>Ratio = 1</strong>: Het model biedt gelijke kansen aan beide groepen in termen van het correct voorspellen van positieve uitkomsten.</li>
<li><strong>Ratio &lt; 1</strong>: Het model biedt minder kansen aan de beschermde groep in vergelijking met de bevoorrechte groep, wat wijst op mogelijke bias tegen de beschermde groep.</li>
<li><strong>Ratio &gt; 1</strong>: Het model biedt meer kansen aan de beschermde groep in vergelijking met de bevoorrechte groep, wat ook op een vorm van bias kan wijzen, maar in het voordeel van de beschermde groep.</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><span class="example">Stel dat we retentie voor havisten (bevoorrecht) en mbo-ers (beschermd) voorspellen en de True Positive Rate voor havisten 70% is en voor mbo-ers 60%. De Equal Opportunity Ratio is dan 0,857 (60% / 70%). Dit betekent dat het model minder kans biedt aan de beschermde groep (mbo-ers) om correct positieve uitkomsten te voorspellen dan aan de bevoorrechte groep (havisten).</span></p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p><span style="     color: rgba(0, 178, 205, 255) !important;"><strong>3. Predictive Equality Ratio</strong></span></p>
<p><em>In welke mate zijn de vals positieve voorspellingen gelijk?</em></p>
<p>Deze maatstaf beoordeelt de gelijkheid van het aantal False Positives (vals-positieven) tussen verschillende subgroepen. Het vergelijkt de False Positive Rate (FPR) voor een beschermde groep met de FPR voor een bevoorrechte groep.</p>
<p>De FPR is de verhouding van het aantal vals-positieve voorspellingen (False Positives, FP) ten opzichte van het totaal aantal werkelijke negatieve gevallen (True Negatives, TN en False Positives, FP). De Predictive Equality Ratio wordt berekend als de verhouding tussen de FPR voor de beschermde groep en de FPR voor de bevoorrechte groep.</p>
<p><strong>Formule</strong></p>
<p><span class="math display">\[ \text{FPR} = \frac{FP}{FP + TN} \]</span></p>
<p><strong>Definities</strong></p>
<ul>
<li><strong>FP</strong>: False Positives (foutieve voorspellingen van positieve uitkomsten)</li>
<li><strong>TN</strong>: True Negatives (correcte voorspellingen van negatieve uitkomsten)</li>
</ul>
<p><strong>Interpretatie</strong></p>
<ul>
<li><strong>Ratio = 1</strong>: Het model heeft een gelijke kans om False Positives te maken voor beide groepen.</li>
<li><strong>Ratio &lt; 1</strong>: Het model heeft minder kans om False Positives te maken voor de beschermde groep dan voor de bevoorrechte groep, wat wijst op mogelijke bias ten nadele van de bevoorrechte groep.</li>
<li><strong>Ratio &gt; 1</strong>: Het model heeft meer kans om False Positives te maken voor de beschermde groep dan voor de bevoorrechte groep, wat wijst op mogelijke bias ten nadele van de beschermde groep.</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><span class="example">Stel dat we retentie voor havisten (bevoorrecht) en mbo-ers (beschermd) voorspellen en de False Positive Rate voor havisten 20% is en voor mbo-ers 30%. De Predictive Equality Ratio is dan 1,5 (30% / 20%). Dit betekent dat het model meer kans heeft om vals-positieve voorspellingen te maken voor de beschermde groep (mbo-ers) dan voor de bevoorrechte groep (havisten).</span></p>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p><span style="     color: rgba(0, 178, 205, 255) !important;"><strong>4. Predictive Parity Ratio</strong></span></p>
<p><em>In welke mate zijn de terecht positieve voorspellingen gelijk?</em></p>
<p>Deze maatstaf beoordeelt de gelijkheid van de nauwkeurigheid van de voorspelling tussen verschillende subgroepen door de positieve voorspellende waarde (Positive Predictive Value, PPV) van het model voor een beschermde groep te vergelijken met die voor een bevoorrechte groep. De PVV wordt ook wel de <strong>precisie</strong> genoemd en wordt berekend als het aantal true positives (TP) gedeeld door het totaal aantal voorspelde positives (TP en FP). Het is een maat voor de nauwkeurigheid van de positieve voorspellingen van het model.</p>
<p><strong>Formule</strong></p>
<p><span class="math display">\[ \text{PPV} = \frac{TP}{TP + FP} \]</span></p>
<p><strong>Definities</strong></p>
<ul>
<li><strong>TP</strong>: True Positives (correcte voorspellingen van positieve uitkomsten)</li>
<li><strong>FP</strong>: False Positives (foutieve voorspellingen van positieve uitkomsten)</li>
</ul>
<p><strong>Interpretatie</strong></p>
<ul>
<li><strong>Ratio = 1</strong>: Het model heeft een gelijke nauwkeurigheid in voorspellingen voor beide groepen.</li>
<li><strong>Ratio &lt; 1</strong>: Het model is minder nauwkeurig in het voorspellen van positieve uitkomsten voor de beschermde groep dan voor de bevoorrechte groep, wat wijst op mogelijke bias tegen de beschermde groep.</li>
<li><strong>Ratio &gt; 1</strong>: Het model is nauwkeuriger in het voorspellen van positieve uitkomsten voor de beschermde groep dan voor de bevoorrechte groep, wat ook op een vorm van bias kan wijzen, maar in het voordeel van de beschermde groep.</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><span class="example">Stel dat we retentie voor havisten (bevoorrecht) en mbo-ers (beschermd) voorspellen en de Positive Predictive Value voor havisten 80% is en voor mbo-ers 70%. De Predictive Parity Ratio is dan 0,875 (70% / 80%). Dit betekent dat het model minder nauwkeurig is in het voorspellen van positieve uitkomsten voor de beschermde groep (mbo-ers) dan voor de bevoorrechte groep (havisten).</span></p>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p><span style="     color: rgba(0, 178, 205, 255) !important;"><strong>5. Statistical Parity Ratio</strong></span></p>
<p><em>In welke mate zijn de positieve voorspellingen gelijk?</em></p>
<p>Deze maatstaf beoordeelt de gelijkheid van de positieve voorspellingen (ongeacht of ze correct zijn of niet) tussen verschillende subgroepen. Het vergelijkt de kans dat een model een positieve uitkomst voorspelt voor een beschermde groep met de kans dat het een positieve uitkomst voorspelt voor een bevoorrechte groep. De Statistical Parity Ratio wordt berekend als de verhouding tussen de kans op een positieve voorspelling voor de beschermde groep en de kans op een positieve voorspelling voor de bevoorrechte groep.</p>
<p><strong>Formule</strong></p>
<p><span class="math display">\[ \text{SPR} = \frac{TP + FP}{TP + FP + TN + FN} \]</span></p>
<p><strong>Definities</strong></p>
<ul>
<li><strong>Positieve Voorspelling</strong>: Een voorspelling waarin het model een positieve uitkomst voorspelt (bijv. aangenomen worden, krediet goedkeuring, etc.).</li>
</ul>
<p><strong>Interpretatie</strong></p>
<ul>
<li><strong>Ratio = 1</strong>: Het model voorspelt even vaak positieve uitkomsten voor beide groepen.</li>
<li><strong>Ratio &lt; 1</strong>: Het model voorspelt minder vaak positieve uitkomsten voor de beschermde groep dan voor de bevoorrechte groep, wat wijst op mogelijke bias tegen de beschermde groep.</li>
<li><strong>Ratio &gt; 1</strong>: Het model voorspelt vaker positieve uitkomsten voor de beschermde groep dan voor de bevoorrechte groep, wat kan wijzen op bias ten nadele van de bevoorrechte groep.</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><span class="example">Stel dat we retentie voor havisten (bevoorrecht) en mbo-ers (beschermd) voorspellen en de kans op een positieve voorspelling voor havisten 80% is en voor mbo-ers 70%. De Statistical Parity Ratio is dan 0,875 (70% / 80%). Dit betekent dat het model minder vaak positieve uitkomsten voorspelt voor de beschermde groep (havisten) dan voor de bevoorrechte groep (mbo-ers).</span></p>
</div>
</div>
</div>
<p>Nu we deze begrippen hebben gedefinieerd, kunnen we de bias en kansengelijkheid van het model voor verschillende groepen studenten analyseren. Hiervoor gebruiken we het <code>fairmodels</code> package van <code>DALEX</code>.</p>
<!-- Verdeling van kansen per groep -->
</section>
<section id="verdeling-van-kansen" class="level3">
<h3 class="anchored" data-anchor-id="verdeling-van-kansen">Verdeling van kansen</h3>
<p>Voordat we in meer detail kansengelijkheid gaan analyseren, onderzoeken we eerst de <em>verdeling van de kansen</em> op retentie voor verschillende groepen studenten voor de variabelen <code>Geslacht</code>, <code>Vooropleiding</code> en <code>Aansluiting</code>. De verdeling van deze kansen is uniek per opleiding.</p>
<p><strong>Toelichting</strong></p>
<ul>
<li>De verdeling van de kansen is te zien door de <em>boxplot</em> en de <em>violin plot</em>.</li>
<li>De boxplot geeft de vier quartielen aan van de data: de box staat voor de middelste 50% van de data, met een streep die de mediaan aangeeft (de middelste waarde van de data). De lijnen (<em>whiskers</em>) geven de 1e 25% en laatste 25% van de data.</li>
<li>De boxplot wordt gecombineerd met de violin plot, waarbij de breedte van de violin de dichtheid van de data aangeeft. Het kan zijn dat het lijkt alsof er geen violin is; in dat geval is de verdeling van het aantal studenten zeer breed en de violin vorm daardoor heel smal.</li>
<li>Samen geven deze twee visualisaties een goed beeld van de verdeling van de voorspelde kansen van het model.</li>
<li>De blauwe gestippelde lijn geeft de 50% kans aan; alle waarden die boven deze lijn valt heeft een kans van 50% of meer op retentie. Hiervan voorspelt het model dat zij niet uitvallen. Deze grenslijn kan door de verdeling van de groepen heen lopen.</li>
</ul>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Maak een fairness analyse</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(group <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Geslacht"</span>, <span class="st">"Vooropleiding"</span>, <span class="st">"Aansluiting"</span>)) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Groep</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Knit_Header</span>(group, <span class="dv">4</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Geslacht"</span>) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"V"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Vooropleiding"</span>) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"HAVO"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Aansluiting"</span>) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"Direct"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een fairness object</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  fobject <span class="ot">&lt;-</span> <span class="fu">Get_objFairness</span>(explain_lf, group, sPrivileged)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een tabel van de fairness analyse</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  dfFairness_totaal <span class="ot">&lt;-</span> <span class="fu">Get_dfFairness_Total</span>(fobject)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een plot van de fairness analyse</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  density_plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Get_Density_Plot</span>(fobject, <span class="at">group =</span> group) </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Bewaar de plot</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  sPlotname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"density_plot_{tolower(group)}"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  sPlotPath <span class="ot">&lt;-</span> <span class="fu">Get_Plot_Outputpath</span>(sPlotname, <span class="at">mode =</span> <span class="st">"plot"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Finalize_Plot</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot_name =</span> density_plot,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">save_filepath =</span> sPlotPath,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">height_pixels =</span> <span class="dv">250</span> <span class="sc">+</span> (<span class="dv">50</span> <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">unique</span>(dfFairness_totaal<span class="sc">$</span>Categorie)))</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Toon de bestaande plot</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  sPlot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"![]({sPlotPath})"</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Knit_Print_Rule</span>(sPlot)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="geslacht" class="level4">
<h4 class="anchored" data-anchor-id="geslacht">Geslacht</h4>
<p><img src="10.%20Output/brv/b-bo-du/plots/density_plot_geslacht.png" class="img-fluid"></p>
</section>
<section id="vooropleiding" class="level4">
<h4 class="anchored" data-anchor-id="vooropleiding">Vooropleiding</h4>
<p><img src="10.%20Output/brv/b-bo-du/plots/density_plot_vooropleiding.png" class="img-fluid"></p>
</section>
<section id="aansluiting" class="level4">
<h4 class="anchored" data-anchor-id="aansluiting">Aansluiting</h4>
<p><img src="10.%20Output/brv/b-bo-du/plots/density_plot_aansluiting.png" class="img-fluid"></p>
</section>
</section>
<section id="fairness-checks" class="level3">
<h3 class="anchored" data-anchor-id="fairness-checks">Fairness checks</h3>
<p>Nu we de verdeling van de kansen kennen, maken we tot slot een fairness analyse voor de variabelen <code>Geslacht</code>, <code>Vooropleiding</code> en <code>Aansluiting</code>. Voor elke groep berekenen we de maatstaven die we eerder hebben behandeld.</p>
<p>We maken een plot van de fairness analyse, waarbij we per variabele één categorie nemen als de bevoorrechte groep; voor Geslacht is dit ‘Vrouw (V)’, voor Vooropleiding is dit ‘havo’ en voor Aansluiting is dit ‘Direct’. Als binnen een variabele een groep een ratio heeft die naar links of naar rechts afwijkt, kan dit duiden op een verschil in kansengelijkheid.</p>
<p>Het wijkt af als de balken verder buiten het groene vlak komen en in het rode vlak; dit is gebaseerd op een marge, <em>epsilon</em>, van 0,8. Deze marge is gebaseerd op het 4/5 principe: er is sprake van een te groot verschil als de maat voor een beschermde groep 4/5 of meer afwijkt van de bevoorrechte groep. Een epsilon van 0,8 leidt tot marges van -0,2 (epsilon/1) en +0,25 (1/espilon). Als er twee ratio’s of meer buiten deze marges vallen, is er volgens dit criterium sprake van bias. Als een maatstaf naar links afwijkt is er sprake van bias naar de beschermde groep (ten nadele), als deze naar rechts afwijkt is er sprake van bias naar de bevoorrechte groep (ten voordele).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota Bene
</div>
</div>
<div class="callout-body-container callout-body">
<p>Als de uitkomstmaat van een model negatief is (zoals uitval), dan moet de interpretatie precies andersom gemaakt worden. Dit geldt voor alle maatstaven van bias en fairness in dit hoofdstuk.</p>
</div>
</div>
<p>Om de robuustheid en betrouwbaarheid in de detectie van bias te waarborgen, moeten er minstens twee metrieke waarden buiten de epsilon-marges vallen voordat er sprake is van bias <span class="citation" data-cites="Barocas.2023">[@Barocas.2023]</span>. Hiervoor is een aantal redenen:</p>
<p><strong>1. Meerdere indicatoren</strong>: Het gebruik van meerdere maatstaven zorgt ervoor dat we de detectie van bias niet baseren op slechts een, mogelijk ruisgevoelige, indicator. Als slechts één metriek buiten de marges valt, kan dit toeval zijn of te wijten zijn aan andere niet-systematische fouten in de data. We spreken dan nog niet over bias. Meerdere metrieke afwijkingen geven een sterkere indicatie van een systematisch probleem.</p>
<p><strong>2. Differentie van bias types</strong>: Bias kan zich op verschillende manieren manifesteren, bijvoorbeeld in termen van ongelijksoortige impact, ongelijke kansen in voorspellingen of ongelijke behandeling. Door meerdere maatstaven te evalueren, onderzoeken we een breder spectrum van potentiële bias en zien we geen aspecten over het hoofd.</p>
<p><strong>3. Normatieve overwegingen</strong>: Vaak is er een normatieve basis voor het definiëren van wat eerlijk is. Het vergelijken van meerdere maatstaven kan helpen om genuanceerder en vollediger beeld te krijgen van hoe een model presteert ten opzichte van verschillende fairness criteria.</p>
<p>De keuze voor twee maatstaven als minimum baseren we op een combinatie van statistische overwegingen en praktische normen binnen het machine learning vakgebied om een goed evenwicht te vinden tussen gevoeligheid (het detecteren van daadwerkelijke bias) en specificiteit (het vermijden van vals positieven) <span class="citation" data-cites="Barocas.2023">[@Barocas.2023]</span>.</p>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Maak een fairness analyse</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(group <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Geslacht"</span>, <span class="st">"Vooropleiding"</span>, <span class="st">"Aansluiting"</span>)) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Groep</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Knit_Header</span>(group, <span class="dv">4</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Geslacht"</span>) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"V"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Vooropleiding"</span>) {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"HAVO"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(group <span class="sc">==</span> <span class="st">"Aansluiting"</span>) {</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    sPrivileged <span class="ot">&lt;-</span> <span class="st">"Direct"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een fairness object</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  fobject <span class="ot">&lt;-</span> <span class="fu">Get_objFairness</span>(explain_lf, group, sPrivileged)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een tabel van de fairness analyse</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  dfFairness_totaal <span class="ot">&lt;-</span> <span class="fu">Get_dfFairness_Total</span>(fobject)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Check of er bias is</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Print_Fairness_Object_LTA</span>(fobject)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Maak een plot van de fairness analyse</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  fairness_plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Get_Fairness_Plot</span>(fobject, <span class="at">group =</span> group, <span class="at">privileged =</span> sPrivileged) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> <span class="st">"darkgrey"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">0.4</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Bewaar de plot</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  sPlotname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"fairness_plot_{tolower(group)}"</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  sPlotPath <span class="ot">&lt;-</span> <span class="fu">Get_Plot_Outputpath</span>(sPlotname, <span class="at">mode =</span> <span class="st">"plot"</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Finalize_Plot</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot_name =</span> fairness_plot,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">save_filepath =</span> sPlotPath,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">height_pixels =</span> <span class="dv">250</span> <span class="sc">+</span> (<span class="dv">50</span> <span class="sc">*</span> <span class="fu">length</span>(<span class="fu">unique</span>(dfFairness_totaal<span class="sc">$</span>Categorie)))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Toon de bestaande plot</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  sPlot <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"![]({sPlotPath})"</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Knit_Print_Rule</span>(sPlot)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="geslacht-1" class="level4">
<h4 class="anchored" data-anchor-id="geslacht-1">Geslacht</h4>
<p><span class="metrics-red">Prognosemodel (Linear Regression) niet geslaagd: 2 van 5 maatstaven </span><br><strong>Totaal verlies</strong> : 2.59</p>
<p><img src="10.%20Output/brv/b-bo-du/plots/fairness_plot_geslacht.png" class="img-fluid"></p>
</section>
<section id="vooropleiding-1" class="level4">
<h4 class="anchored" data-anchor-id="vooropleiding-1">Vooropleiding</h4>
<p><span class="metrics-red">Prognosemodel (Linear Regression) niet geslaagd: 0 van 5 maatstaven </span><br><strong>Totaal verlies</strong> : 12.35</p>
<p><img src="10.%20Output/brv/b-bo-du/plots/fairness_plot_vooropleiding.png" class="img-fluid"></p>
</section>
<section id="aansluiting-1" class="level4">
<h4 class="anchored" data-anchor-id="aansluiting-1">Aansluiting</h4>
<p><span class="metrics-red">Prognosemodel (Linear Regression) niet geslaagd: 0 van 5 maatstaven </span><br><strong>Totaal verlies</strong> : 8.41</p>
<p><img src="10.%20Output/brv/b-bo-du/plots/fairness_plot_aansluiting.png" class="img-fluid"></p>
<!-- Conclusies -->
</section>
</section>
</section>
<section id="conclusies" class="level2">
<h2 class="anchored" data-anchor-id="conclusies">Conclusies</h2>
<p>Hier komen de conclusies.</p>
<!-- Referenties -->
</section>
<section id="literatuur" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="literatuur">Literatuur</h2>
<div id="refs" role="list">

</div>
<!-- Verantwoording -->
<p>&nbsp;</p>
<p><strong>Verantwoording</strong></p>
<p>Deze analyse maakt deel uit van het onderzoek naar kansengelijkheid van het lectoraat Learning Technology &amp; Analytics van De Haagse Hogeschool: <a href="https://www.dehaagsehogeschool.nl/onderzoek/kenniscentra/no-fairness-without-awareness">No Fairness without Awareness</a> | Het rapport is door het lectoraat ontwikkeld in <a href="https://quarto.org/">Quarto</a> 1.4.549. | Template versie: 0.9.1.9000</p>
<!-- Copyright -->
<p>&nbsp;</p>
<p><strong>Copyright</strong></p>
<p>Dr.&nbsp;Theo Bakker, Lectoraat Learning Technology &amp; Analytics, De Haagse Hogeschool © 2023-2024. Alle rechten voorbehouden.</p>
<!-- Opschonen -->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>